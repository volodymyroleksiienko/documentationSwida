<th:block xmlns:th="http://www.w3.org/1999/xhtml"
          xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
          th:fragment="contracts">
    <!-- Контракты  START-->
    <div class="tab-pane fade show active container-fluid" id="contracts-tab">
        <table class="table table-hover table-striped" id="contracts-tab-table">
            <br>
            <thead>
            <tr>
                <th scope="col">id</th>
                <th scope="col">Код</th>
                <th scope="col">Порода</th>
                <th scope="col">Описание</th>
                <th scope="col">Покупатель</th>
                <th scope="col">Заказ, м<sup>3</sup></th>
                <th scope="col">Отгружено, м<sup>3</sup></th>
                <th scope="col">Остаток, м<sup>3</sup></th>
                <th scope="col">Назначение</th>
                <th scope="col">Срок выполнения</th>
                <th sec:authorize="hasRole('ROLE_ADMIN')"></th>
                <th scope="col">extentForDistribution</th>
                <th scope="col">Agent id</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="b : ${orderInfoList}" th:id="${b.id}">
                <td th:text="${b.id}"></td>
                <th scope="row" th:text="${b.codeOfOrder}"></th>
                <td th:text="${b?.breedOfTree?.breed}"></td>
                <td th:text="${b.breedDescription}"></td>
                <td th:text="${(b.contrAgent!=null)?b.contrAgent.nameOfAgent:''}"></td>
                <td th:text="${b.extentOfOrder}"></td>
                <td th:text="${b.doneExtendOfOrder}"></td>
                <td th:text="${b.toDoExtentOfOrder}"></td>
                <td th:text="${b.destinationType}"></td>
                <td th:text="${b.date}" class="change-color"></td>
                <td sec:authorize="hasRole('ROLE_ADMIN')">
                    <button type="button" class="btn btn-primary btn-sm" onclick="distributeContract(this)"><i class="fas fa-th" data-toggle="tooltip" title="Распределение"></i></button>
                    <button type="button" class="btn btn-primary btn-sm" onclick="editContract(this)"><i class="fas fa-pen" data-toggle="tooltip" title="Редактировать"></i></button>
                </td>
                <td th:text="${b.extentForDistribution}"></td>
                <td th:text="${b?.contrAgent?.id}"></td>
            </tr>
            </tbody>
            <tfoot>
            <tr>
                <th scope="col">id</th>
                <th scope="col">Код</th>
                <th scope="col">Порода</th>
                <th scope="col">Описание</th>
                <th scope="col">Покупатель</th>
                <th scope="col">Заказ, м<sup>3</sup></th>
                <th scope="col">Отгружено, м<sup>3</sup></th>
                <th scope="col">Остаток, м<sup>3</sup></th>
                <th scope="col">Назначение</th>
                <th scope="col">Срок выполнения</th>
                <th sec:authorize="hasRole('ROLE_ADMIN')"></th>
                <th scope="col">extentForDistribution</th>
                <th scope="col">Agent id</th>
            </tr>
            </tfoot>
        </table>
        <!-- BUTTON START-->
        <div class="float-action-button" sec:authorize="hasRole('ROLE_ADMIN')">
            <button type="button" class="buttons main-button btn btn-primary" title="Добавить" data-toggle="modal" data-placement="left" data-target="#addContractModal">
                <i class="fa fa-plus"></i>
            </button>
        </div>
        <!-- BUTTON END-->
    </div>

    <!-- Контракты END -->
    <!-- EDIT CONTRACT MODAL START -->
    <div class="modal fade" id="editContractModal">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editContractModalHeader">Редактировать</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form action="/admin/editContarct" method="post">
                    <div class="modal-body">
                        <input type="text" id="editContractId" hidden="" name="id">

                        <label class="col-form-label" for="editContractCode">Код</label>
                        <input type="text" class="form-control" id="editContractCode" placeholder="Не заполнено" required="required" autocomplete="off" name="codeOfOrder">

                        <label class="col-form-label" for="editContractBuyer">Покупатель</label>
                        <input type="text" class="form-control" list="editContractBuyerList" id="editContractBuyer" placeholder="Не заполнено" required="required" autocomplete="off" onchange="setHiddenValue(this)">
                        <datalist id="editContractBuyerList">
                            <option th:each="b : ${contrAgentList}" th:data-value="${b.id}"  th:text="${b.nameOfAgent}"></option>
                        </datalist>
                        <input type="number" hidden="hidden"  name="contrAgent.id" id="editContractBuyer-hidden">

                        <div class="form-group row d-flex" style="align-items: flex-end; margin-bottom: 0">
                            <div class="col-6">
                                <label class="control-label" for="editContractBreedOfTree">Порода</label>
                                <input type="text" class="form-control" list="editBreedOfTreeList" placeholder="Не заполнено" id="editContractBreedOfTree" required="required" autocomplete="off" name="breedOfTree.breed">
                                <datalist id="editBreedOfTreeList">
                                    <option th:each="b : ${breedOfTreeList}"  th:value="${b.breed}">
                                </datalist>
                            </div>

                            <div class="col-6">
                                <label class="col-form-label" for="editBreedDescriptionContract">Описание</label>
                                <input type="text" class="form-control" id="editBreedDescriptionContract" autocomplete="off" placeholder="Не заполнено" name="breedDescription">
                            </div>
                        </div>


                        <div class="form-group row d-flex" style="align-items: flex-end; margin-bottom: 0">
                            <div class="col-6">
                                <label class="col-form-label" for="editContractOrder">Заказ  м<sup>3</sup></label>
                                <input type="number" step="any" min="0" class="form-control" id="editContractOrder" required="required" pattern="[0-9]*\.?[0-9]*" autocomplete="off" placeholder="м3" name="extentOfOrder">
                            </div>

                            <div class="col-6">
                                <label class="col-form-label" for="editContractDone">Отгружено  м<sup>3</sup></label>
                                <input type="number" step="any" class="form-control" id="editContractDone" required="required" pattern="[0-9]*\.?[0-9]*" autocomplete="off" placeholder="м3" name="doneExtendOfOrder">
                            </div>
                        </div>

                        <div class="form-group row d-flex" style="align-items: flex-end;margin-bottom: 0">
                            <div class="col-6">
                                <label class="col-form-label" for="editContractLeft">Остаток  м<sup>3</sup></label>
                                <input type="number" step="any" class="form-control" id="editContractLeft" required="required" pattern="[0-9]*\.?[0-9]*" autocomplete="off" disabled="disabled" placeholder="м3">
                            </div>

                            <div class="col-6">
                                <label class="col-form-label" for="editContractDate">Срок выполнения</label>
                                <input class="form-control" type="date" id="editContractDate" required="required" name="date">
                            </div>
                            <div class="col-12">
                                <label for="editOrderDeliveryDestination" class="col-form-label">Пункт назначения</label>
                                <input type="text" class="form-control" list="editDestinationType" placeholder="Не заполнено" id="editOrderDeliveryDestination" required="required" autocomplete="off" name="destinationType">
                                <datalist id="editDestinationType">
                                    <option value="MULTIMODAL">
                                    <option value="PORT">
                                    <option value="COUNTRY">
                                </datalist>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary">Сохранить</button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Отмена</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        function editContract(btnObj) {

            var trObj = btnObj.parentElement.parentElement;
            var trId =  $(trObj).attr('id');
            $('#editContractId').val(trId);
            console.log(  $(trObj).attr('id'));
            var contractCode = $(trObj).find('th:eq(0)').text();
            $('#editContractModalHeader').text("Редактировать контракт №"+contractCode);

            var breedOfTree =       $(trObj).find('td:eq(0)').text();
            var breedDescription =  $(trObj).find('td:eq(1)').text();
            var buyer =             $(trObj).find('td:eq(2)').text();
            var buyerId =           $(trObj).find('td:eq(10)').text();
            var amount =            $(trObj).find('td:eq(3)').text();
            var done =              $(trObj).find('td:eq(4)').text();
            var left =              $(trObj).find('td:eq(5)').text();
            var destination =       $(trObj).find('td:eq(6)').text();
            let deadline =          $(trObj).find('td:eq(7)').text();

            console.log("date on modal " + deadline);

            $('#editContractCode')              .val(contractCode);
            $('#editContractBreedOfTree')       .val(breedOfTree);
            $('#editBreedDescriptionContract')  .val(breedDescription);
            $('#editContractBuyer')             .val(buyer);
            $('#editContractBuyer-hidden')      .val(buyerId);
            $('#editContractOrder')             .val(amount);
            $('#editContractDone')              .val(done);
            $('#editContractLeft')              .val(left);
            $('#editOrderDeliveryDestination')  .val(destination);
            $('#editContractDate')              .val(deadline);

            $('#editContractModal').modal('show');
        }
    </script>
    <!-- EDIT CONTRACT MODAL END -->

    <!-- ADD CONTRACT MODAL START -->
    <div class="modal fade" id="addContractModal">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Добавить контракт</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form action="/admin/addContract" method="post">
                    <div class="modal-body">

                        <label class="col-form-label" for="addContractCode">Код</label>
                        <input type="text" class="form-control" id="addContractCode" required="required" placeholder="Не заполнено" autocomplete="off" name="codeOfOrder">

                        <label class="col-form-label" for="addContractBuyer">Покупатель</label>
                        <input type="text" class="form-control" list="contrAgentList" id="addContractBuyer" placeholder="Не заполнено" required="required" autocomplete="off" onchange="setHiddenValue(this)">
                        <datalist id="contrAgentList">
                            <option th:each="b : ${contrAgentList}" th:data-value="${b.id}"  th:text="${b.nameOfAgent}"></option>
                        </datalist>
                        <input type="number" hidden="hidden"  name="contrAgent.id" id="addContractBuyer-hidden">

                        <div class="form-group row d-flex" style="align-items: flex-end; margin-bottom: 0">
                            <div class="col-6">
                                <label class="control-label" for="addContractBreedOfTree">Порода</label>
                                <input type="text" class="form-control" list="addBreedOfTreeList" id="addContractBreedOfTree" placeholder="Не заполнено" required="required" autocomplete="off" name="breedOfTree.breed">
                                <datalist id="addBreedOfTreeList">
                                    <option th:each="b : ${breedOfTreeList}"  th:value="${b.breed}">
                                </datalist>
                            </div>

                            <div class="col-6">
                                <label class="col-form-label" for="addBreedDescriptionContract">Описание</label>
                                <input type="text" class="form-control" id="addBreedDescriptionContract" placeholder="Не заполнено" autocomplete="off"  name="breedDescription">
                            </div>
                        </div>

                        <div class="form-group row d-flex" style="align-items: flex-end; margin-bottom: 0">
                            <div class="col-6">
                                <label class="col-form-label" for="addContractOrder">Заказ  м<sup>3</sup></label>
                                <input type="number" step="any" class="form-control" id="addContractOrder" required="required" pattern="[0-9]*\.?[0-9]*" autocomplete="off" placeholder="м3" name="extentOfOrder">
                            </div>

                            <div class="col-6">
                                <label class="col-form-label" for="addContractDate">Срок выполнения</label>
                                <input class="form-control" type="date" id="addContractDate" required="required" name="date">
                            </div>
                            <div class="col-12">
                                <label for="addOrderDeliveryDestination" class="col-form-label">Пункт назначения</label>
                                <input type="text" class="form-control" list="destinationType" placeholder="Не заполнено" id="addOrderDeliveryDestination" required="required" autocomplete="off" name="destinationType">
                                <datalist id="destinationType">
                                    <option value="MULTIMODAL">
                                    <option value="PORT">
                                    <option value="COUNTRY">
                                </datalist>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary">Добавить</button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Отмена</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        document.querySelector("#addContractDate").valueAsDate = new Date();
    </script>
    <!-- ADD CONTRACT MODAL END -->

    <!-- CREATE DISTRIBUTION START -->
    <div class="modal fade" id="createDistributionModal">
        <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title " id="distributionModalHeader">Распределение заказа</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form>
                    <div class="modal-body">

                        <div class="form-group row d-flex" style="align-items: flex-end">
                            <input type="text" id="sendDistributionModalId" hidden="" name="id">
                            <input type="text" id="sendDistributionModalCode" hidden="" name="code">
                            <input type="text" id="maxExtentValue" hidden="" name="maxExtent">

                            <div class="col-3">
                                <label class="control-label" for="addDistributionCode" style="padding-top: 7px">Код</label>
                                <input type="text" class="form-control" id="addDistributionCode" required="required" placeholder="Не заполнено" autocomplete="off"  name="extent">
                            </div>

                            <div class="col-5">
                                <label class="control-label" for="addDistributionCompanyInner">Поставщик</label>
                                <input type="text" class="form-control" list="suppliersList" id="addDistributionCompanyInner" placeholder="Не заполнено" required="required" autocomplete="off" onchange="setHiddenValue(this)">
                                <datalist id="suppliersList">
                                    <option th:each="b : ${contrAgentProviderList}"  th:data-value="${b.id}" th:text="${b.nameOfAgent}"></option>
                                </datalist>
                                <input type="hidden" name="orderInfo.contrAgent.id" id="addDistributionCompanyInner-hidden">
                            </div>

                            <div class="col-2">
                                <label class="control-label" for="addDistributionAmountInner" style="padding-top: 7px">Заказ, м<sup>3</sup></label>
                                <input type="number" step="0.1" min="0.000" pattern="[0-9]*\.?[0-9]*" class="form-control" id="addDistributionAmountInner" required="required" autocomplete="off" placeholder="м3" name="extent">
                            </div>

                            <div class="col-2">
                                <button id="buttonForAddingDistributionRow"  type="button" class="btn btn-primary" style="width: 100%">Добавить</button>
                            </div>
                        </div>

                        <table class="table table-hover table-striped" id="tableOfDistribution">
                            <thead>
                            <tr>
                                <th scope="col">Код</th>
                                <th scope="col">Поставщик</th>
                                <th scope="col">Заказ, м<sup>3</sup></th>
                                <th scope="col">Поставщик id</th>
                                <th></th>
                            </tr>
                            </thead>

                            <tbody id="listOfDistributionsId">
                            <!-- <tr></tr> -->
                            </tbody>

                            <tfoot>
                            <tr>
                                <th scope="col">Код</th>
                                <th scope="col">Поставщик</th>
                                <th scope="col">Заказ, м<sup>3</sup></th>
                                <th scope="col">Поставщик id</th>
                                <th></th>
                            </tr>
                            </tfoot>

                        </table>

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" id="createDistributionButton" onclick="sendRequestForDistribution(this)">Распределить</button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Отмена</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        // SHOW MODAL START
        function distributeContract(btnObj) {
            let trObj = btnObj.parentElement.parentElement;
            let trId =  $(trObj).attr('id');
            $('#sendDistributionModalId').val(trId);
            // console.log($(trObj).attr('id'));
            let codeOfOrder =           $(trObj).find('th:eq(0)').text();
            const  mainCode =           $(trObj).find('th:eq(0)').text();
            const possibleExtent =      parseFloat($(trObj).find('td:eq(9)').text()).toFixed(3);

            $('#distributionModalHeader').text("Распределение заказа №"+codeOfOrder);

            $('#sendDistributionModalCode')     .val(mainCode);
            $('#addDistributionCode')           .val(codeOfOrder);


            $('#maxExtentValue')                .val(possibleExtent);
            $('#addDistributionAmountInner')    .val(possibleExtent);

            $('#addDistributionAmountInner')    .attr({"max" : possibleExtent});
            $('#createDistributionModal').modal('show');
        }
        // SHOW MODAL END

        // AJAX REQUEST START
        function sendRequestForDistribution(btnObj) {
            let idOfMainOrder = $('#sendDistributionModalId').val();
            console.log("id of main  "+idOfMainOrder);
            let arrOfTr = document.getElementById("listOfDistributionsId").getElementsByTagName("tr");

            let arrayOfCodes     = [];
            let arrayOfSuppliers = [];
            let arrayOfOrderings = [];

            for (let i = 0; i<arrOfTr.length;i++){
                arrayOfCodes[i]     =      $(arrOfTr[i]).find('td:eq(0)').text();
                arrayOfSuppliers[i] =      $(arrOfTr[i]).find('td:eq(3)').text();
                arrayOfOrderings[i] =      $(arrOfTr[i]).find('td:eq(2)').text();
            }

            console.log("codes: "         +arrayOfCodes);
            console.log("suppliers ids: " +arrayOfSuppliers);
            console.log("order extent: "  +arrayOfOrderings);


            if (arrayOfSuppliers[0]!=="No data available in table"){
                $.ajax({
                    method: "post",
                    url: "/createDistribution",
                    contextType: "application/json",
                    data: {
                        id:idOfMainOrder,
                        codesList: arrayOfCodes,
                        suppliersList: arrayOfSuppliers,
                        orderingsList: arrayOfOrderings
                    },
                    traditional: true,
                    success: function () {
                        location.reload();
                    },
                    error: function () {
                    alert("Error");
                    }
                });
            }else {
                alert("Внесите записи!");
            }

        }
        // AJAX REQUEST END
    </script>
    <!-- CREATE DISTRIBUTION END -->
</th:block>





<th:block xmlns:th="http://www.w3.org/1999/xhtml" th:fragment="orders" xmlns:sec="http://www.thymeleaf.org">
    <!-- Распределение  START-->
    <div class="tab-pane fade show active container-fluid" id="distribution-tab">
        <table class="table table-hover table-striped" id="distribution-tab-table">
            <br>
            <thead>
            <tr>
                <th scope="col">id</th>
                <th scope="col">Код</th>
                <th scope="col">Порода</th>
                <th scope="col">Описание</th>
                <th scope="col">Поставщик</th>
                <th scope="col">Заказ, м<sup>3</sup></th>
                <th scope="col">Отгружено, м<sup>3</sup></th>
                <th scope="col">Остаток, м<sup>3</sup></th>
                <th scope="col">Срок выполнения</th>
                <th sec:authorize="hasRole('ROLE_ADMIN')"></th>
                <th scope="col">extentForDistribution main order</th>
                <th scope="col">date main order</th>
                <th scope="col">Agent id</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="b : ${orderInfoList}" th:id="${b.id}">
                <td th:text="${b.id}"></td>
                <th scope="row" th:text="${b.codeOfOrder}"></th>
                <td th:text="${b?.breedOfTree?.breed}"></td>
                <td th:text="${b.breedDescription}"></td>
                <td th:text="${(b.contrAgent!=null)?b.contrAgent.nameOfAgent:''}"></td>
                <td th:text="${b.extentOfOrder}"></td>
                <td th:text="${b.doneExtendOfOrder}"></td>
                <td th:text="${b.toDoExtentOfOrder}"></td>
                <td th:text="${b.date}" class="change-color"></td>
                <td sec:authorize="hasRole('ROLE_ADMIN')">
                    <button type="button" class="btn btn-primary btn-sm" onclick="editDistribution(this)"><i class="fas fa-pen" data-toggle="tooltip" title="Редактировать"></i></button>
                </td>
                <td th:text="${(b.mainOrder!=null)? b.mainOrder.extentForDistribution:''}"></td>
                <td th:text="${(b.mainOrder!=null)? b.mainOrder.date:''}"></td>
                <td th:text="${b?.contrAgent?.id}"></td>
            </tr>
            </tbody>

            <tfoot>
            <tr>
                <th scope="col">id</th>
                <th scope="col">Код</th>
                <th scope="col">Порода</th>
                <th scope="col">Описание</th>
                <th scope="col">Поставщик</th>
                <th scope="col">Заказ, м<sup>3</sup></th>
                <th scope="col">Отгружено, м<sup>3</sup></th>
                <th scope="col">Остаток, м<sup>3</sup></th>
                <th scope="col">Срок выполнения</th>
                <th sec:authorize="hasRole('ROLE_ADMIN')"></th>
                <th scope="col">extentForDistribution main order</th>
                <th scope="col">date main order</th>
                <th scope="col">Agent id</th>
            </tr>
            </tfoot>
        </table>
    </div>
    <!-- Распределение END -->

    <!-- EDIT DISTRIBUTION MODAL START -->
    <div class="modal fade" id="editDistributionModal">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editDistributionModalHeader">Редактировать</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form action="/admin/editOrder" method="post" id="editDistributionModalForm">
                    <div class="modal-body">
                        <input type="text" id="editDistributionId" hidden="" name="id">
                        <input type="text" id="mainDeadline" hidden="" name="deadline">
                        <input type="text" id="mainPossibleExtent" hidden="" name="maxExtent">

                        <label class="col-form-label" for="editDistributionCode">Код</label>
                        <input type="text" class="form-control" id="editDistributionCode" required="required" autocomplete="off" name="codeOfOrder">

                        <label class="col-form-label" for="editDistributionCompany">Поставщик</label>
                        <input type="text" class="form-control" list="contrAgentProviderList" id="editDistributionCompany" required="required" autocomplete="off" onchange="setHiddenValue(this)">
                        <datalist id="contrAgentProviderList">
                            <option th:each="b : ${contrAgentProviderList}"  th:data-value="${b.id}"  th:text="${b.nameOfAgent}"></option>
                        </datalist>
                        <input type="number" hidden="hidden"  name="contrAgent.id" id="editDistributionCompany-hidden">

                        <div class="form-group row d-flex" style="align-items: flex-end; margin-bottom: 0">
                            <div class="col-6">
                                <label class="control-label" for="editDistributionBreedOfTree">Порода</label>
                                <input type="text" class="form-control" list="breedOfTreeList1" id="editDistributionBreedOfTree" required="required" autocomplete="off" name="breedOfTree.breed">
                                <datalist id="breedOfTreeList1">
                                    <option th:each="b : ${breedOfTreeList}"  th:value="${b.breed}">
                                </datalist>
                            </div>

                            <div class="col-6">
                                <label class="col-form-label" for="editBreedDescription">Описание</label>
                                <input type="text" class="form-control" id="editBreedDescription" autocomplete="off"  name="breedDescription">
                            </div>
                        </div>

                        <div class="form-group row d-flex" style="align-items: flex-end; margin-bottom: 0">
                            <div class="col-6">
                                <label class="col-form-label" for="editDistributionOrder">Заказ</label>
                                <input type="number" step="any" min="0.00" class="form-control" id="editDistributionOrder" pattern="[0-9]*\.?[0-9]*" required="required" autocomplete="off" placeholder="м3" name="extentOfOrder">
                            </div>

                            <div class="col-6">
                                <label class="col-form-label" for="editDistributionDone">Отгружено</label>
                                <input type="number" step="any" class="form-control" id="editDistributionDone" pattern="[0-9]*\.?[0-9]*" required="required" autocomplete="off" placeholder="м3" name="doneExtendOfOrder">
                            </div>
                        </div>

                        <div class="form-group row d-flex" style="align-items: flex-end;margin-bottom: 0">
                            <div class="col-6">
                                <label class="col-form-label" for="editDistributionLeft">Остаток</label>
                                <input type="number" step="any" class="form-control" id="editDistributionLeft" pattern="[0-9]*\.?[0-9]*" required="required" autocomplete="off" disabled="disabled" placeholder="м3" name="toDoExtentOfOrder">
                            </div>

                            <div class="col-6">
                                <label class="col-form-label" for="editOrderContractDate">Срок выполнения</label>
                                <input class="form-control" type="date" id="editOrderContractDate" required="required" name="date">
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary">Сохранить</button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Отмена</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        function editDistribution(btnObj) {
            var trObj = btnObj.parentElement.parentElement;
            var trId =  $(trObj).attr('id');
            $('#editDistributionId').val(trId);
            console.log(  $(trObj).attr('id'));
            var contractCode = $(trObj).find('th:eq(0)').text();
            $('#editDistributionModalHeader').text("Редактировать заказ №"+contractCode);

            var breedOfTree =       $(trObj).find('td:eq(0)').text();
            var breedDescription =  $(trObj).find('td:eq(1)').text();
            var company =           $(trObj).find('td:eq(2)').text();
            var amount =            parseFloat($(trObj).find('td:eq(3)').text());
            var done =              $(trObj).find('td:eq(4)').text();
            var left =              $(trObj).find('td:eq(5)').text();
            var deadline =          $(trObj).find('td:eq(6)').text();
            var agentId =           $(trObj).find('td:eq(10)').text();

            let mainDeadline =          $(trObj).find('td:eq(9)').text();
            let mainPossibleExtent =    parseFloat($(trObj).find('td:eq(8)').text());

            $('#mainDeadline')            .val(mainDeadline);
            $('#mainPossibleExtent')      .val((mainPossibleExtent+amount).toFixed(3));


            $('#editDistributionCode')          .val(contractCode);
            $('#editDistributionBreedOfTree')   .val(breedOfTree);
            $('#editBreedDescription')          .val(breedDescription);
            $('#editDistributionCompany')       .val(company);
            $('#editDistributionOrder')         .val(amount);
            $('#editDistributionDone')          .val(done);
            $('#editDistributionLeft')          .val(left);
            $('#editOrderContractDate')         .val(deadline);
            $('#editDistributionCompany-hidden').val(agentId);

            $('#editDistributionModal').modal('show');
        }

        document.querySelector("#editDistributionModalForm").addEventListener("submit", function(e){
            let mainVal = new Date($('#mainDeadline').val());
            let newVal =  new Date($('#editOrderContractDate').val());

            let maxExtent = parseFloat($('#mainPossibleExtent').val());
            let newExtent = parseFloat($('#editDistributionOrder').val());

            console.log("main: "+mainVal.getTime()+"; new: "+newVal.getTime());
            console.log("maxExt: "+maxExtent+"; newExt: "+newExtent);

            if(newVal.getTime()>mainVal.getTime()) {
                alert("Дата не может быть познее значения главного заказа!");
                $('#editOrderContractDate').val($('#mainDeadline').val());
                e.preventDefault();
            }else if (newExtent>maxExtent){
                alert("Кубатура превышает допустимую, максимально возможное число: "+maxExtent.toFixed(3)+" м3");
                e.preventDefault();
            }else {
                return true;
            }
        });
    </script>
    <!-- EDIT DISTRIBUTION MODAL END -->

    <!-- ADD DISTRIBUTION MODAL START -->
    <div class="modal fade" id="addDistributionModal">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Добавить заказ</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form action="/addDistribution">
                    <div class="modal-body">

                        <label class="col-form-label" for="addDistributionCode">Код</label>
                        <input type="text" class="form-control" id="addDistributionCode" required="required" autocomplete="off">

                        <div class="form-group row d-flex" style="align-items: flex-end; margin-bottom: 0">
                            <div class="col-6">
                                <label class="control-label" for="addDistributionBreedOfTree">Порода</label>
                                <input type="text" class="form-control" list="breedOfTreeList" id="addDistributionBreedOfTree" required="required" autocomplete="off">
                                <datalist id="breedOfTreeList">
                                    <option th:each="b : ${breedOfTreeList}"  th:value="${b.breed}">
                                </datalist>
                            </div>

                            <div class="col-6">
                                <label class="col-form-label" for="addBreedDescription">Описание</label>
                                <input type="text" class="form-control" id="addBreedDescription" autocomplete="off"  name="breedDescription">
                            </div>
                        </div>

                        <label class="col-form-label" for="addDistributionCompany">Поставщик</label>
                        <input type="text" class="form-control" id="addDistributionCompany" required="required" autocomplete="off">

                        <div class="form-group row d-flex" style="align-items: flex-end; margin-bottom: 0">
                            <div class="col-6">
                                <label class="col-form-label" for="addDistributionOrder">Заказ</label>
                                <input type="number" step="any" class="form-control" id="addDistributionOrder" pattern="[0-9]*\.?[0-9]*" required="required" autocomplete="off" placeholder="м3">
                            </div>

                            <div class="col-6">
                                <label class="col-form-label" for="addOrderContractDate">Срок выполнения</label>
                                <input class="form-control" type="date" id="addOrderContractDate" required="required" name="date">
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button submit" class="btn btn-primary">Добавить</button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Отмена</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!-- ADD DISTRIBUTION MODAL END -->
    <!-- MODALS END-->

</th:block>





<!--Delivery order page-->

<th:block xmlns:th="http://www.w3.org/1999/xhtml" th:fragment="ordersForDelivery" xmlns:sec="http://www.thymeleaf.org">
    <!-- Распределение  START-->
    <div class="tab-pane fade show active container-fluid" id="distribution-tab">
        <table class="table table-hover table-striped" id="distribution-tab-table">
            <br>
            <thead>
            <tr>
                <th scope="col">id</th>
                <th scope="col">Код</th>
                <th scope="col">Порода</th>
                <th scope="col">Описание</th>
                <th scope="col">Поставщик</th>
                <th scope="col">Заказ, м<sup>3</sup></th>
                <th scope="col">Отгружено, м<sup>3</sup></th>
                <th scope="col">Остаток, м<sup>3</sup></th>
                <th scope="col">Срок выполнения</th>
                <th scope="col">Статус</th>
                <th ></th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="b : ${orderInfoList}" th:id="${b.id}">
                <td th:text="${b.id}"></td>
                <th scope="row" th:text="${b.codeOfOrder}"></th>
                <td th:text="${b.breedOfTree.breed}"></td>
                <td th:text="${b.breedDescription}"></td>
                <td th:text="${(b.contrAgent!=null)?b.contrAgent.nameOfAgent:''}"></td>
                <td th:text="${b.extentOfOrder}"></td>
                <td th:text="${b.doneExtendOfOrder}"></td>
                <td th:text="${b.toDoExtentOfOrder}"></td>
                <td th:text="${b.date}" class="change-color"></td>
                <td th:text="${b.statusOfEntity}"></td>
                <td >
                    <a class="btn btn-primary btn-sm" th:href="@{'/multimodal/getDeliveryTrucksByContract-'+${b.id}}"><i class="fas fa-info-circle" data-toggle="tooltip" title="Подробно"></i></a>
                    <button sec:authorize="hasRole('ROLE_ADMIN')" type="button" class="btn btn-primary btn-sm" onclick="sendToArchive(this)"><i class="far fa-folder-open" data-toggle="tooltip" title="В архив"></i></button>
                </td>
            </tr>
            </tbody>

            <tfoot>
            <tr>
                <th scope="col">id</th>
                <th scope="col">Код</th>
                <th scope="col">Порода</th>
                <th scope="col">Описание</th>
                <th scope="col">Поставщик</th>
                <th scope="col">Заказ, м<sup>3</sup></th>
                <th scope="col">Отгружено, м<sup>3</sup></th>
                <th scope="col">Остаток, м<sup>3</sup></th>
                <th scope="col">Срок выполнения</th>
                <th scope="col">Статус</th>
                <th ></th>
            </tr>
            </tfoot>
        </table>
        <!-- BUTTON START-->
        <div class="float-action-button" sec:authorize="hasRole('ROLE_ADMIN')">
            <button type="button" class="buttons main-button btn btn-primary" title="Импорт" data-placement="left" onclick="importData()">
                <i class="fas fa-file-import">&nbsp;</i>
            </button>
        </div>
        <!-- BUTTON END-->
    </div>
    <!-- Распределение END -->
    <!-- IMPORT MODAL START -->
    <div class="modal fade" id="importModal">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Импорт из Excel</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <!--       HERE         -->
                <form th:action="@{/multimodal/importOakXLS}" method="post" id="importForm" enctype="multipart/form-data">
                    <!--       HERE                 -->
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="inputFile">Выберите файл</label>
                            <input type="file" required="required" class="form-control-file" id="inputFile" aria-describedby="fileHelp" accept="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel" name="fileXLS">
                            <!-- <small id="fileHelp" class="form-text text-muted">This is some placeholder block-level help text for the above input. It's a bit lighter and easily wraps to a new line.</small> -->
                            <label class="col-form-label" for="importSetContract">Привязать контракт</label>
                            <input type="text" class="form-control" list="contractsList" id="importSetContract" required="required" autocomplete="off" onchange="setHiddenValue(this)">
                            <datalist id="contractsList">
                                <option  th:each="c : ${distributeOrderList}" th:data-value="${c.id}" th:text="${c.codeOfOrder}" th:label="${c?.contrAgent?.nameOfAgent}">
                                </option>
                            </datalist>
                            <input type="number" hidden="hidden"  name="contractId" id="importSetContract-hidden">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button submit" id="importButton" class="btn btn-primary">Импорт</button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Отмена</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        function importData() {
            $('#importModal').modal('show');
        }
    </script>
    <!-- IMPORT MODAL END -->

    <!-- CONFIRMATION MODAL START -->
    <div class="modal fade" id="archiveConfirmationModal">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Архив</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <!--       HERE         -->
                <form th:action="${urlSendToArchive}" method="post">
                    <!--       HERE                 -->
                    <div class="modal-body">
                        <div class="form-group">
                            <input type="text" class="form-control" id="archiveRecordModalId" hidden="hidden" autocomplete="off" name="id">

                            <p id="archiveModalConfirmation">

                            </p>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button submit" class="btn btn-primary">В архив</button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Отмена</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        function sendToArchive(btnObj) {
            var trObj = btnObj.parentElement.parentElement;
            var trId =  $(trObj).attr('id');
            $('#archiveRecordModalId').val(trId);
            console.log(  $(trObj).attr('id'));
            var codeOfContract = $(trObj).find('th:eq(0)').text();

            $('#archiveModalConfirmation').text("Вы уверены, что хотите отправить в архив контракт №"+codeOfContract+" ?");
            $('#archiveConfirmationModal').modal('show');
        }
    </script>
    <!-- CONFIRMATION MODAL END -->

</th:block>2